module Inquisition
  module Outputter
    class Xlsx
      class GemDetailedInfo
        class Vulnerability
          RUNNER_CLASS = Inquisition::Bundler::Audit::Runner
          MESSAGE = 'The current version of the gem is vulnerables'.freeze
          COLOR = '#ff0000'

          def initialize(collection:, gem_name:)
            @collection = collection
            @gem_name = gem_name
          end

          def call
            {
              detailed_status: detailed_status,
              color: color
            }
          end

          private

          def detailed_status
            MESSAGE if has_vulnerability?
          end

          def color
            COLOR if has_vulnerability?
          end

          def has_vulnerability?
            @has_vulnerability ||= collection.detect do |item|
              item.runner.class == RUNNER_CLASS && item.additional_data[:gem_name] == gem_name
            end.present?
          end

          attr_reader :collection, :gem_name
        end
      end
    end
  end
end
