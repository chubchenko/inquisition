!!!
%html{:lang => "en"}
  %head
    %meta{:content => "text/html; charset=UTF-8", "http-equiv" => "Content-Type"}/
    %meta{:charset => "utf-8"}/
    %meta{:content => "IE=edge", "http-equiv" => "X-UA-Compatible"}/
    %meta{:content => "width=device-width, initial-scale=1", :name => "viewport"}/
    %link{:href => "images/favicon.ico", :rel => "icon", :type => "image/ico"}/
    %title Code Auditor!
    %link{:href => "assets/css/bootstrap/dist/css/bootstrap.min.css", :rel => "stylesheet"}/
    %link{:href => "assets/css/font-awesome/css/font-awesome.min.css", :rel => "stylesheet"}/
    %link{:href => "assets/css/nprogress/nprogress.css", :rel => "stylesheet"}/
    %link{:href => "assets/css/iCheck/skins/flat/green.css", :rel => "stylesheet"}/
    %link{:href => "assets/css/bootstrap-progressbar/css/bootstrap-progressbar-3.3.4.min.css", :rel => "stylesheet"}/
    %link{:href => "assets/css/jqvmap/dist/jqvmap.min.css", :rel => "stylesheet"}/
    %link{:href => "assets/css/bootstrap-daterangepicker/daterangepicker.css", :rel => "stylesheet"}/
    %link{:href => "assets/css/custom.css", :rel => "stylesheet"}/
    %link{:href => "assets/css/percircle.css", :rel => "stylesheet"}/
  %body.nav-md
    .container.body
      .main_container
        .col-md-3.left_col
          .left_col.scroll-view
            .navbar.nav_title{:style => "border: 0;"}
              %a.site_title{:href => "index.html"}
                %i.fa.fa-paw
                %span Code Auditor!
            .clearfix
            .profile.clearfix
              .profile_pic
                %img.img-circle.profile_img{:alt => "...", :src => "images/img.jpg"}/
            %br/
            .main_menu
              %nav#sidebar
                .sidebar-header
                  %h3 Reports
                %ul.nav.side-menu
                  - menu_items.each do |item|
                    %li
                      - if item[:child_items] && item[:child_items].any?
                        %a.dropdown-toggle{"aria-expanded" => "false", "data-toggle" => "collapse", :href => "##{item[:class]}"}
                          = item[:name]
                          %span.fa.fa-chevron-down
                        %ul.collapse.nav.side-menu{ id: item[:class] }
                          - item[:child_items].each do |child_item|
                            %li
                              - if child_item[:child_items] && child_item[:child_items].any?
                                %a.dropdown-toggle{"aria-expanded" => "false", "data-toggle" => "collapse", :href => "##{child_item[:class]}"}
                                  = child_item[:name]
                                  %span.fa.fa-chevron-down
                                %ul.collapse.nav.side-menu{ id: child_item[:class] }
                                  - child_item[:child_items].each do |nested_item|
                                    %li
                                      %a{:href => "#{nested_item[:link]}"}= nested_item[:name]
                              - else
                                %a{:href => "#{child_item[:link]}"}= child_item[:name]
                      - else
                        %a{:href => "#{item[:link]}"}= item[:name]
        .top_nav
          .nav_menu
            %nav
              .nav.toggle
                %a#menu_toggle
                  %i.fa.fa-bars
              %ul.nav.navbar-nav.navbar-right
                %li
                  %a.user-profile{:class => "aria-expanded=", :false => "", :href => "javascript:;"}
                    %i.fa.fa-envelope-o
                    = succeed "code_auditor@rubygarage.org" do
                      %img{:alt => "", :src => "images/img.jpg"}/
        .right_col{:role => "main"}
          .row.tile_count
            .col-md-2.col-sm-4.col-xs-6.tile_stats_count
              %span.count_top
                %i.fa.fa-table
                Database tables
              .count= tables_count
            .col-md-2.col-sm-4.col-xs-6.tile_stats_count
              %span.count_top
                %i.fa.fa-bug
                Errors found
              .count= total_errors
            .col-md-2.col-sm-4.col-xs-6.tile_stats_count
              %span.count_top
                %i.fa.fa-check-square
                Included linters
              .count= included_linters_count
            .col-md-2.col-sm-4.col-xs-6.tile_stats_count
              %span.count_top
                %i.fa.fa-cog
                Migrations count
              .count= total_migrations
            .col-md-2.col-sm-4.col-xs-6.tile_stats_count
              %span.count_top
                %i.fa.fa-database
                Database adapter
              .count= database_adapter
            .col-md-2.col-sm-4.col-xs-6.tile_stats_count
              %span.count_top
                %i.fa.fa-cog
                Schema version
              .count{ style: "font-size: 30px; line-height: 30px;" }
                = schema_version[:date]
                %br
                = schema_version[:time]
          %br/
          .row
            .col-md-12.col-sm-12.col-xs-12
              .x_panel.tile
                .x_title
                  %h2 Errors summary in percents
                  .clearfix
                .x_content.row
                  .col-md-3.col-sm-3.col-xs-12{ style: "text-align:center" }
                    %h4 Tables with repeated indexes
                    #repeated-indexes-percent.custom-circles{"data-percent" => "#{repeated_indexes_percentage}"}
                    %small Ratio between numbers of tables with repeated indexes and total tables
                    %br
                    %small
                      100 * tei / tt
                      %b where:
                    %br
                    %small
                      %b tei -
                      total tables with repeated indexes
                    %br
                    %small
                      %b tt -
                      total tables
                  .col-md-3.col-sm-3.col-xs-12{ style: "text-align:center" }
                    %h4 Tables with missing foreign keys
                    #missing-foreign-keys-percent.custom-circles{"data-percent" => "#{missing_foreign_keys_percentage}"}
                    %small Ratio between numbers of tables with missing foreign keys and total tables
                    %br
                    %small
                      100 * tmk / tt
                      %b where:
                    %br
                    %small
                      %b tmk -
                      total tables with missing foreign keys
                    %br
                    %small
                      %b tt -
                      total tables
                  .col-md-3.col-sm-3.col-xs-12{ style: "text-align:center" }
                    %h4 Incompatibility tables structure with models
                    #incompatibility-structure-percent.custom-circles{"data-percent" => "#{incompatibility_structure_with_models_percentage}"}
                    %small Ratio between numbers of tables with incompatibility tables structure with models and total tables
                    %br
                    %small
                      100 * tis / tt
                      %b where:
                    %br
                    %small
                      %b tis -
                      total tables with incompatibility structure with models
                    %br
                    %small
                      %b tt -
                      total tables
                  .col-md-3.col-sm-3.col-xs-12{ style: "text-align:center" }
                    %h4 Unindexed foreign keys
                    #unindexed-foreign-keys-percent.custom-circles{"data-percent" => "#{unindexed_foreign_keys_percentage}"}
                    %small Ratio between unindexed foreign keys with models and total tables
                    %br
                    %small
                      100 * ufk / tt
                      %b where:
                    %br
                    %small
                      %b ufk -
                      total tables with unindexed foreign keys
                    %br
                    %small
                      %b tt -
                      total tables
          .row
            .col-md-6.col-sm-6.col-xs-12
              .x_panel.tile.fixed_height_320
                .x_title
                  %h2 Top 5 tables with errors
                  .clearfix
                .x_content
                  %h4 Tables summary
                  - top_tables_with_errors(5).each do |error|
                    .widget_summary
                      .w_left.w_25
                        %span= error[:table_name]
                      .w_center.w_55
                        .progress
                          .progress-bar.bg-green{"aria-valuemin" => "0", :role => "progressbar", :style => "width: #{error[:total_errors_percent]}%;"}
                      .w_right.w_20
                        %span= error[:error_count]
                      .clearfix
            .col-md-6.col-sm-6.col-xs-12
              .x_panel.tile.fixed_height_320.overflow_hidden
                .x_title
                  %h2 Most populate errors
                  .clearfix
                .x_content
                  %table{:style => "width:100%"}
                    %tr
                      %th{:style => "width:37%;"}
                        %p Top 5
                      %th
                        .col-lg-7.col-md-7.col-sm-7.col-xs-7
                          %p Error
                        .col-lg-5.col-md-5.col-sm-5.col-xs-5
                          %p Tables
                    %tr
                      %td
                        %canvas#most_populars_errors{:height => "140", :style => "margin: 15px 10px 10px 0", :width => "140"}
                      %td
                        %table.tile_info
                          - top_types_of_errors(5).each do |error|
                            %tr
                              %td
                                %p
                                  %i.fa.fa-square{class: "#{error[:chart_color]}"}>
                                  = error[:error_name]
                              %td= error[:tables_count]
        / /page content
        / footer content
        %footer
          .pull-right
            Gentelella - Bootstrap Admin Template by
            %a{:href => "https://colorlib.com"} Colorlib
          .clearfix
        / /footer content
    %script{:src => "assets/js/jquery/dist/jquery.min.js"}
    %script{:src => "assets/js/bootstrap/dist/js/bootstrap.min.js"}
    %script{:src => "assets/js/fastclick/lib/fastclick.js"}
    %script{:src => "assets/js/nprogress/nprogress.js"}
    %script{:src => "assets/js/Chart.js/dist/Chart.min.js"}
    %script{:src => "assets/js/gauge.js/dist/gauge.min.js"}
    %script{:src => "assets/js/bootstrap-progressbar/bootstrap-progressbar.min.js"}
    %script{:src => "assets/js/iCheck/icheck.min.js"}
    %script{:src => "assets/js/skycons/skycons.js"}
    %script{:src => "assets/js/Flot/jquery.flot.js"}
    %script{:src => "assets/js/Flot/jquery.flot.pie.js"}
    %script{:src => "assets/js/Flot/jquery.flot.time.js"}
    %script{:src => "assets/js/Flot/jquery.flot.stack.js"}
    %script{:src => "assets/js/Flot/jquery.flot.resize.js"}
    %script{:src => "assets/js/flot.orderbars/js/jquery.flot.orderBars.js"}
    %script{:src => "assets/js/flot-spline/js/jquery.flot.spline.min.js"}
    %script{:src => "assets/js/flot.curvedlines/curvedLines.js"}
    %script{:src => "assets/js/DateJS/build/date.js"}
    %script{:src => "assets/js/jqvmap/dist/jquery.vmap.js"}
    %script{:src => "assets/js/jqvmap/dist/maps/jquery.vmap.world.js"}
    %script{:src => "assets/js/jqvmap/examples/js/jquery.vmap.sampledata.js"}
    %script{:src => "assets/js/moment/min/moment.min.js"}
    %script{:src => "assets/js/bootstrap-daterangepicker/daterangepicker.js"}
    %script{:src => "assets/js/custom.min.js"}

    %script{:src => "assets/js/percircle.js"}

    :javascript
      $(function(){
          $("#repeated-indexes-percent, #missing-foreign-keys-percent, #incompatibility-structure-percent, #unindexed-foreign-keys-percent").percircle();
      });

      function init_chart_doughnut(){

        if( typeof (Chart) === 'undefined'){ return; }
        if ($('#most_populars_errors').length){
          var chart_doughnut_settings = {
            type: 'doughnut',
            tooltipFillColor: "rgba(51, 51, 51, 0.55)",
            data: {
              labels: #{top_types_of_errors(5).map{|x| x[:error_name]}},
              datasets: [
                {
                  data: #{top_types_of_errors(5).map{|x| x[:tables_count]}},
                  backgroundColor: [
                    "#3498DB",
                    "#BDC3C7",
                    "#9B59B6",
                    "#E74C3C",
                    "#26B99A"
                  ],
                  hoverBackgroundColor: [
                    "#49A9EA",
                    "#CFD4D8",
                    "#B370CF",
                    "#E95E4F",
                    "#36CAAB"
                  ]
                }
              ]
            },
            options: {
            legend: false,
            responsive: false
            }
          }
          var chart_element = $('#most_populars_errors');
          var chart_doughnut = new Chart( chart_element, chart_doughnut_settings);
        }
      }
