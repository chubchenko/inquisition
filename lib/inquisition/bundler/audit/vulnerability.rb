module Inquisition
  module Bundler
    module Audit
      class Vulnerability
        def initialize(issue)
          @issue = issue
        end

        def to_h
          { path: nil, line: nil, category: Category::SECURITY, name: issue.gem.name }
        end

        private

        attr_reader :issue
      end

      class UnpatchedGem < Vulnerability
        def to_h
          super.merge(
            severity: issue.advisory.criticality || Severity::LOW,
            message: issue.advisory.title.strip
          )
        end
      end

      class InsecureSource < Vulnerability
        def to_h
          super.merge(
            severity: Severity::MEDIUM,
            message: message
          )
        end

        def message
          "Insecure Source URI found: #{issue.source}"
        end
      end
    end
  end
end
