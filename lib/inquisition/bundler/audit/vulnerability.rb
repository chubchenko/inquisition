module Inquisition
  module Bundler
    module Audit
      class Vulnerability
        def to_h
          { path: nil, line: nil, category: Category::SECURITY }
        end
      end

      class UnpatchedGem < Vulnerability
        def initialize(issue)
          @issue = issue
          @advisory = issue.advisory
        end

        def to_h
          super.merge(
            severity: advisory.criticality || Severity::LOW,
            message: advisory.title.strip,
            aditional_data: issue
          )
        end

        private

        attr_reader :advisory, :issue
      end

      class InsecureSource < Vulnerability
        def initialize(issue)
          @issue = issue
          @source = issue.source
        end

        def to_h
          super.merge(
            severity: Severity::MEDIUM,
            message: message,
            aditional_data: issue
          )
        end

        private

        attr_reader :source, :issue

        def message
          "Insecure Source URI found: #{source}"
        end
      end
    end
  end
end
